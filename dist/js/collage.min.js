!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Collage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){this.opts=i.extend({},j,b),this.el=a;var c=a.querySelector("form");if(this.opts.uploader?this.uploader=new e(this.opts.uploader):c&&(this.uploader=new e({form:c})),a){this.opts.fileDrop&&(this.filedrop=new f(a,this.opts.fileDrop),this.filedrop.subscribe("file",this.onfile.bind(this)));var d=a.querySelector(".collage-list");d&&this.opts.sortable&&(this.list=d,this.sortable=new h(d))}}var e=a("./lib/FileUploader.js"),f=a("./elements/FileDrop.js"),g=a("./elements/Img.js"),h=a("./elements/Sortable.js"),i=a("./lib/util.js");b.exports=d;var j={uploader:null,fileDrop:{},sortable:!0};d.prototype=i.extend({uploader:null,add:function(a){Array.isArray(a)&&a.forEach(function(a){this._add(a)}.bind(this))},_add:function(a){var b=this.img(a);this.list&&this.list.appendChild(b.el),this.sortable&&this.sortable.add(b.el),this.publish("onadd",b)},img:function(a){return new g(a,{uploader:this.uploader})},onfile:function(a){this._add(a)}},i.pubsub)},{"./elements/FileDrop.js":2,"./elements/Img.js":3,"./elements/Sortable.js":4,"./lib/FileUploader.js":5,"./lib/util.js":8}],2:[function(a,b,c){"use strict";function d(a){a.preventDefault(),a.stopPropagation()}function e(a,b){this.opts=f.extend({},g,b),this.el=a,this.input=a.querySelector('input[type="file"]'),this.el.addEventListener("drop",this.ondrop.bind(this)),this.el.addEventListener("dragenter",d),this.el.addEventListener("dragover",d),this.input&&this.input.addEventListener("change",this.ondrop.bind(this))}var f=a("./../lib/util.js");b.exports=e;var g={maxsize:10,format:"jpe?g|png|gif",filesPerDrop:20};e.prototype=f.extend({validate:function(a){var b=a.size/1e6<=this.opts.maxsize,c=a.name.match(".("+this.opts.format+")$");return b&&c},ondrag:function(){},ondrop:function(a){a.preventDefault();for(var b=a.currentTarget.files?a.currentTarget.files:a.dataTransfer.files,c=0;c<b.length&&!(c>=this.filesPerDrop);c++){var d=this.validate(b[c]);d?this.publish("file",b[c]):this.publish("invalid",b[c])}}},f.pubsub)},{"./../lib/util.js":8}],3:[function(a,b,c){"use strict";function d(a,b){this.opts=e.extend({},g,b),this.setEl(),a instanceof File?(this.file=a,this.setEl(this.opts.uploader),this.readFile(a),this.opts.uploader&&this.upload()):(this.setEl(),this.setBg(a))}var e=a("./../lib/util.js"),f=a("./../lib/resize.js");b.exports=d;var g={uploader:null,url:null,params:null,mode:"bg"};d.prototype={setEl:function(a){this.el=document.createElement("span"),this.el.className="collage-img"+("bg"===this.opts.mode?" collage-bg":""),a&&(this.el.innerHTML='<div class="collage-progress"><div class="progress-bar"></div><div class="progress-text"></div></div>',this.progress=this.el.querySelector(".collage-progress"),this.bar=this.el.querySelector(".progress-bar"),this.text=this.el.querySelector(".progress-text"))},readFile:function(a){var b=new FileReader;b.onload=this.onread.bind(this),b.onerr=this.onerr.bind(this),b.readAsDataURL(a)},onread:function(a){var b=f(a.target.result,500,500);this.setBg(b)},onerr:function(){},setBg:function(a){"bg"===this.opts.mode&&(this.el.style="background-image: url("+a+")")},setProgress:function(a){a=Math.round(100*a),this.bar.style="width: "+a+"%",this.text.innerHTML=a+"%"},upload:function(){var a=this.opts.uploader.upload(this.file,this.opts.url,this.opts.params);a.subscribe("success",this.onsuccess.bind(this)),a.subscribe("progress",this.onprogress.bind(this)),a.subscribe("fail",this.onfail.bind(this))},onsuccess:function(a,b){this.setBg(b),this.progress.parentNode.removeChild(this.progress)},onprogress:function(a,b){this.setProgress(b)},onfail:function(){this.text.innerHTML="Upload Failed"}}},{"./../lib/resize.js":7,"./../lib/util.js":8}],4:[function(a,b,c){"use strict";function d(a,b){var c=a.nextSibling,d=b.nextSibling;a.parentNode.insertBefore(a,d),b.parentNode.insertBefore(b,c)}function e(a,b){this.selector=b?b:"[draggable]",f.on(a,"dragstart",this.selector,this.ondragstart.bind(this)),f.on(a,"dragover",this.selector,this.ondragover.bind(this)),f.on(a,"dragend",this.selector,this.ondragend.bind(this)),a.className+=" collage-sortable"}var f=a("./../lib/util.js");b.exports=e;e.prototype=f.extend({target:null,add:function(a){a.draggable=!0},ondragstart:function(a){this.target=a.target,this.target.style.zIndex=10},ondragover:function(a){a.target!==this.target&&d(a.target,this.target)},ondragend:function(){this.target.style.zIndex="",this.target=null},on:function(){}},f.pubsub)},{"./../lib/util.js":8}],5:[function(a,b,c){"use strict";function d(a){this.opts=f.extend({},g,a)}var e=a("./UploadTask"),f=a("./util.js");b.exports=d;var g={url:null,params:null,form:null};d.prototype={parallel:3,timeoutRetry:2,queue:[],processing:[],upload:function(a,b,c){b=b?b:this.opts.url?this.opts.url:this.opts.form.action,c=c?c:this.opts.params;var d=new e(b,this.getFormData(a,c));return d.subscribe("success",this.onsuccess.bind(this)),d.subscribe("fail",this.onfail.bind(this)),d.subscribe("timeout",this.ontimeout.bind(this)),this.processing.length>=this.parallel?this.queue.push(d):this.run(d),d},getFormData:function(a,b){var c=new FormData(this.opts.form);return c.append("file",a),b instanceof Array&&b.forEach(function(a){c.append(a.name,a.value)}),c},run:function(a){this.processing.push(a),a.submit()},done:function(a){if(f.remove(this.processing,a),this.queue.length>=1){var b=this.queue[0];this.run(b),f.remove(this.queue,b)}},onsuccess:function(a){this.done(a)},onfail:function(a){this.done(a)},ontimeout:function(a){a.timeouts>this.timeoutRetry?a.onfail():a.submit()}}},{"./UploadTask":6,"./util.js":8}],6:[function(a,b,c){"use strict";function d(a,b){this.url=a,this.formData=b}var e=a("./util.js");b.exports=d,d.prototype=e.extend({timeouts:0,submit:function(){var a=this.xhr=new XMLHttpRequest;a.upload.onprogress=this.onprogress.bind(this),a.ontimeout=this.ontimeout.bind(this),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?this.onsuccess(a):0!==a.status&&this.onfail())}.bind(this),a.timeout=6e4,a.open("post",this.url),a.send(this.formData)},onsuccess:function(a){this.publish("success",this,a.responseText,a.status)},onprogress:function(a){this.publish("progress",this,a.loaded/a.total)},ontimeout:function(){this.timeouts++,this.publish("timeout",this)},onfail:function(){this.publish("fail",this)}},e.pubsub)},{"./util.js":8}],7:[function(a,b,c){"use strict";function d(a,b,c){var d=document.createElement("canvas"),f=d.getContext("2d"),g=new Image;g.src=a;var h=e(g,{width:b,height:c});return d.width=h.width,d.height=h.height,f.drawImage(g,0,0,h.width,h.height),d.toDataURL("image/png")}function e(a,b){var c,d=a.height/a.width,e=!1;return b.height||(e=!0),b.width&&b.height&&(c=b.height/b.width,c>d&&(e=!0)),e?{width:b.width,height:b.width*d}:{width:b.height/d,height:b.height}}b.exports=d},{}],8:[function(a,b,c){"use strict";b.exports={transition:function(a,b){a.style.webkitTransition=b,a.style.MozTransition=b,a.style.OTransition=b,a.style.transition=b},transform:function(a,b){a.style.webkitTransform=b,a.style.MozTransform=b,a.style.OTransform=b,a.style.transform=b},matches:function(a,b){var c=Element.prototype,d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||function(a){return-1!==[].indexOf.call(document.querySelectorAll(a),this)};return d.call(a,b)},on:function(a,b,c,d){a.addEventListener(b,function(a){this.matches(a.target,c)&&d.apply(window,arguments)}.bind(this))},remove:function(a,b){a.splice(a.indexOf(b),1)},extend:function(){for(var a,b=arguments[0],c=1;c<arguments.length;c++){a=arguments[c];for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}return b},pubsub:{subscribe:function(a,b){this._observers||(this._observers={});var c=this._observers[a];c instanceof Array||(c=this._observers[a]=[]),c.push(b)},unsubscribe:function(a,b){var c=this._observers[a];c.splice(c.indexOf(b),1)},publish:function(a){this._observers||(this._observers={});var b=this._observers[a],c=Array.prototype.slice.call(arguments,1);if(b)for(var d=0;d<b.length;d++)b[d].apply(this,c)}}}},{}]},{},[1])(1)});