!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Collage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){this.uploader=new e}var e=a("./lib/FileUploader.js");b.exports=d,d.prototype={}},{"./lib/FileUploader.js":2}],2:[function(a,b,c){"use strict";function d(){}var e=a("./UploadTask"),f=a("./util.js");b.exports=d,d.prototype={parallel:3,timeoutRetry:2,queue:[],processing:[],url:null,params:null,upload:function(a,b,c){b=b?b:this.url,c=c?c:this.params;var d=new e(b,a,c);return d.subscribe("success",this.onsuccess.bind(this)),d.subscribe("fail",this.onfail.bind(this)),d.subscribe("timeout",this.ontimeout.bind(this)),this.processing.length>=this.parallel?this.queue.push(d):this.run(d),d},run:function(a){this.processing.push(a),a.submit()},done:function(a){if(f.remove(this.processing,a),this.queue.length>1){var b=this.queue[0];this.run(b),f.remove(this.queue,b)}},onsuccess:function(a){this.done(a)},onfail:function(a){this.done(a)},ontimeout:function(a){a.timeouts>this.timeoutRetry?a.onfail():a.submit()}}},{"./UploadTask":3,"./util.js":4}],3:[function(a,b,c){"use strict";function d(a,b,c){this.url=a,this.data=new FormData,this.data.append("file",b),c instanceof Array&&c.forEach(function(a){this.data.append(a.name,a.value)})}var e=a("./util.js");b.exports=d,d.prototype=e.extend({timeouts:0,submit:function(){var a=this.xhr=new XMLHttpRequest;a.onprogress=this.onprogress.bind(this),a.ontimeout=this.ontimeout.bind(this),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?this.onsuccess(a):this.onfail())}.bind(this),a.timeout=3e3,a.open("post",this.url),a.send(this.data)},onsuccess:function(a){this.publish("success",this,a.responseText,a.status)},onprogress:function(){this.publish("progress",this)},ontimeout:function(){this.timeouts++,this.publish("timeout",this)},onfail:function(){this.publish("fail",this)}},e.pubsub)},{"./util.js":4}],4:[function(a,b,c){"use strict";b.exports={remove:function(a,b){a.splice(a.indexOf(b),1)},extend:function(){for(var a,b=arguments[0],c=1;c<arguments.length;c++){a=arguments[c];for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}return b},pubsub:{_observers:{},subscribe:function(a,b){var c=this._observers[a];c instanceof Array||(c=this._observers[a]=[]),c.push(b)},unsubscribe:function(a,b){var c=this._observers[a];c.splice(c.indexOf(b),1)},publish:function(a){var b=this._observers[a],c=Array.prototype.slice.call(arguments,1);if(b)for(var d=0;d<b.length;d++)b[d].apply(this,c)}}}},{}]},{},[1])(1)});