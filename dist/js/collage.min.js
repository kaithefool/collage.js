!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Collage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(a,b){this.opts=i.extend({},j,b),this.uploader=new e(this.opts.uploader),a&&(this.list=a.querySelector(".collage-list"),this.opts.fileDrop&&(this.filedrop=new f(a,this.opts.fileDrop),this.filedrop.subscribe("file",this.onfile.bind(this))),this.opts.sortable&&(this.sortable=new h(this.list)))}var e=a("./lib/FileUploader.js"),f=a("./elements/FileDrop.js"),g=a("./elements/Img.js"),h=a("./elements/Sortable.js"),i=a("./lib/util.js");b.exports=d;var j={uploader:{},fileDrop:{},sortable:!0};d.prototype={getImg:function(a){return new g(a,{uploader:this.uploader})},onfile:function(a){var b=this.getImg(a);this.list.appendChild(b.el)}}},{"./elements/FileDrop.js":2,"./elements/Img.js":3,"./elements/Sortable.js":4,"./lib/FileUploader.js":5,"./lib/util.js":7}],2:[function(a,b,c){"use strict";function d(a){a.preventDefault(),a.stopPropagation()}function e(a,b){this.opts=f.extend({},g,b),this.el=a,this.input=a.querySelector('input[type="file"]'),this.el.addEventListener("drop",this.ondrop.bind(this)),this.el.addEventListener("dragenter",d),this.el.addEventListener("dragover",d),this.input&&this.input.addEventListener("change",this.ondrop.bind(this))}var f=a("./../lib/util.js");b.exports=e;var g={maxsize:10,format:"jpe?g|png|gif"};e.prototype=f.extend({validate:function(a){var b=a.size/1e6<=this.opts.maxsize,c=a.name.match(".("+this.opts.format+")$");return b&&c},ondrag:function(){},ondrop:function(a){a.preventDefault();for(var b=a.currentTarget.files?a.currentTarget.files:a.dataTransfer.files,c=0;c<b.length&&!(c>20);c++){var d=this.validate(b[c]);d&&this.publish("file",b[c])}}},f.pubsub)},{"./../lib/util.js":7}],3:[function(a,b,c){"use strict";function d(a,b){this.opts=e.extend({},f,b),this.file=a,this.setEl(),this.readFile(a),this.opts.uploader&&this.upload()}var e=a("./../lib/util.js");b.exports=d;var f={uploader:null,url:null,params:null,src:null};d.prototype={setEl:function(){this.el=document.createElement("div"),this.el.className="collage-img",this.el.innerHTML='<div class="collage-progress"><div class="progress-bar"></div><div class="progress-text"></div></div>',this.progress=this.el.querySelector(".collage-progress"),this.bar=this.el.querySelector(".progress-bar"),this.text=this.el.querySelector(".progress-text")},readFile:function(a){var b=new FileReader;b.onload=this.onread.bind(this),b.onerr=this.onerr.bind(this),b.readAsDataURL(a)},onread:function(a){this.setBg(a.target.result)},onerr:function(){},setBg:function(a){this.el.style="background-image: url("+a+")"},setProgress:function(a){a=Math.round(100*a),this.bar.style="width: "+a+"%",this.text.innerHTML=a+"%"},upload:function(){var a=this.opts.uploader.upload(this.file,this.opts.url,this.opts.params);a.subscribe("success",this.onsuccess.bind(this)),a.subscribe("progress",this.onprogress.bind(this)),a.subscribe("fail",this.onfail.bind(this))},onsuccess:function(a,b){this.setBg(b),this.progress.parentNode.removeChild(this.progress)},onprogress:function(a,b){this.setProgress(b)},onfail:function(){this.text.innerHTML="Upload Failed"}}},{"./../lib/util.js":7}],4:[function(a,b,c){"use strict";function d(a,b){this.selector=b,a.addEventListener("mousedown",this.onmousedown.bind(this))}var e=a("./../lib/util.js");b.exports=d,d.prototype=e.extend({onmousedown:function(a){e.matches(a.target,this.selector)&&console.log("touch")},onmouseover:function(){},onmouseup:function(){},on:function(){}},e.pubsub)},{"./../lib/util.js":7}],5:[function(a,b,c){"use strict";function d(a){this.opts=f.extend({},g,a)}var e=a("./UploadTask"),f=a("./util.js");b.exports=d;var g={url:null,params:null};d.prototype={parallel:3,timeoutRetry:2,queue:[],processing:[],upload:function(a,b,c){b=b?b:this.opts.url,c=c?c:this.opts.params;var d=new e(b,this.getFormData(a,c));return d.subscribe("success",this.onsuccess.bind(this)),d.subscribe("fail",this.onfail.bind(this)),d.subscribe("timeout",this.ontimeout.bind(this)),this.processing.length>=this.parallel?this.queue.push(d):this.run(d),d},getFormData:function(a,b){var c=new FormData;return c.append("file",a),b instanceof Array&&b.forEach(function(a){c.append(a.name,a.value)}),c},run:function(a){this.processing.push(a),a.submit()},done:function(a){if(f.remove(this.processing,a),this.queue.length>=1){var b=this.queue[0];this.run(b),f.remove(this.queue,b)}},onsuccess:function(a){this.done(a)},onfail:function(a){this.done(a)},ontimeout:function(a){a.timeouts>this.timeoutRetry?a.onfail():a.submit()}}},{"./UploadTask":6,"./util.js":7}],6:[function(a,b,c){"use strict";function d(a,b){this.url=a,this.formData=b}var e=a("./util.js");b.exports=d,d.prototype=e.extend({timeouts:0,submit:function(){var a=this.xhr=new XMLHttpRequest;a.upload.onprogress=this.onprogress.bind(this),a.ontimeout=this.ontimeout.bind(this),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?this.onsuccess(a):0!==a.status&&this.onfail())}.bind(this),a.timeout=6e4,a.open("post",this.url),a.send(this.formData)},onsuccess:function(a){this.publish("success",this,a.responseText,a.status)},onprogress:function(a){this.publish("progress",this,a.loaded/a.total)},ontimeout:function(){this.timeouts++,this.publish("timeout",this)},onfail:function(){this.publish("fail",this)}},e.pubsub)},{"./util.js":7}],7:[function(a,b,c){"use strict";b.exports={matches:function(a,b){(a.matches||a.matchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector)(b)},remove:function(a,b){a.splice(a.indexOf(b),1)},extend:function(){for(var a,b=arguments[0],c=1;c<arguments.length;c++){a=arguments[c];for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}return b},pubsub:{subscribe:function(a,b){this._observers||(this._observers={});var c=this._observers[a];c instanceof Array||(c=this._observers[a]=[]),c.push(b)},unsubscribe:function(a,b){var c=this._observers[a];c.splice(c.indexOf(b),1)},publish:function(a){var b=this._observers[a],c=Array.prototype.slice.call(arguments,1);if(b)for(var d=0;d<b.length;d++)b[d].apply(this,c)}}}},{}]},{},[1])(1)});